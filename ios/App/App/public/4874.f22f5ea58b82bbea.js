"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4874],{5961:(C,_,o)=>{o.d(_,{GW:()=>i,dk:()=>l,oK:()=>r});var r=(()=>((r=r||{}).Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r))(),i=(()=>((i=i||{}).Rear="REAR",i.Front="FRONT",i))(),l=(()=>((l=l||{}).Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",l))()},4874:(C,_,o)=>{o.r(_),o.d(_,{UpdateKalibrasiPageModule:()=>B});var r=o(6814),i=o(7852),l=o(4670),f=o(5861),g=o(95),P=o(6676),b=o(7394),S=o(2726),c=o(5961);const u=(0,S.fo)("Camera",{web:()=>o.e(6468).then(o.bind(o,6468)).then(n=>new n.CameraWeb)});var t=o(6689),d=o(3454),h=o(2690),p=o(5175),A=o(5557);function M(n,m){1&n&&(t.TgZ(0,"div",18),t._UZ(1,"ion-spinner",19),t.qZA())}function N(n,m){if(1&n&&t.GkF(0,20),2&n){t.oxw();const a=t.MAs(56);t.Q6J("ngTemplateOutlet",a)}}function E(n,m){if(1&n&&t.GkF(0,20),2&n){t.oxw();const a=t.MAs(58);t.Q6J("ngTemplateOutlet",a)}}function O(n,m){}function D(n,m){if(1&n){const a=t.EpF();t.TgZ(0,"ion-button",21),t.NdJ("click",function(){t.CHM(a);const s=t.oxw();return t.KtG(s.sendNotificationBPFK())}),t._uU(1,"Kirim Notifikasi BPFK"),t.qZA()}}const F=[{path:"",component:(()=>{class n{constructor(a,e,s,v,K,Z,y){this.router=a,this.global=e,this.inputAlatKesehatanServices=s,this.authServices=v,this.fb=K,this.navExtras=Z,this.actionSheetController=y,this.formTitle="Update Kalibrasi",this.isLoading=!1,this.allDataAlatKesehatanById=[],this.allDataAlatKesehatanByIdSub=new b.w0,this.today=P().format("YYYY-MM-DD"),this.resultData=[],this.calibration_status="",this.id_alat="",this.imgUrl="",this.image_ext="",this.messageMonth=""}ngOnInit(){this.getAuth(),this.allDataAlatKesehatanById=this.navExtras.getExtras(),this.resultData.push(this.navExtras.getExtras()),this.resultData.forEach(a=>{console.log("element",a.details[0].calibration_status),this.myForm=this.fb.group({tanggal:[this.today,[g.kI.required]],monitoring_status:[""],name:[a.name],pic:[a.pic],inventory_no:[a.inventory_no],room:[a.room],type:[a.type],calibration_status:[""],owner_id:[a.owner_id],initial_calibration:[a.details[0].initial_calibration],re_calibration:[a.details[0].re_calibration],initial_monitoring:[a.details[0].initial_monitoring],re_monitoring:[a.details[0].re_monitoring]}),this.messageMonth=a.details[0].month_diff,this.messageMonth=!(this.messageMonth>6),console.log("this.messageMonth",this.messageMonth),this.id_alat=a.id,this.imgUrl=a.image,null==a.calibration_status?(this.myForm.form="gagal_kalibrasi",this.calibration_status="status_belum_diisi"):(this.myForm.form=a.calibration_status,this.calibration_status=a.calibration_status),console.log("this imgUrl",this.imgUrl)})}getAuth(){var a=this;return(0,f.Z)(function*(){const e=yield a.authServices.getId();if(e){let s=JSON.parse(e);console.log("this.token",s.access_token),a.token=s.access_token}})()}sendNotificationBPFK(){var a=this;let e=this.myForm.value;try{setTimeout((0,f.Z)(function*(){console.log("getAuth(){",a.token),yield a.inputAlatKesehatanServices.sendAndCreateNotificationBPFK(e,a.token)}),1e3)}catch(s){throw s}}uploadImage(){var a=this;return(0,f.Z)(function*(){yield(yield a.actionSheetController.create({header:"Choose from",buttons:[{text:"Gallery",icon:"images",handler:()=>{console.log("gallery clicked"),a.upload(c.oK.Photos)}},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]})).present()})()}upload(a){var e=this;return(0,f.Z)(function*(){try{const s=yield u.getPhoto({source:a,quality:50,resultType:c.dk.Base64});if(console.log("image output",s),s&&s.base64String){const v=e.b64toBlob(s.base64String,`image/${s.format}`);e.image_ext=s.format,e.blobData=v}}catch(s){console.log(s),e.global.apiErrorHandler(s)}})()}b64toBlob(a,e="",s=512){const v=atob(a),K=[];for(let y=0;y<v.length;y+=s){const T=v.slice(y,y+s),x=new Array(T.length);for(let U=0;U<T.length;U++)x[U]=T.charCodeAt(U);const J=new Uint8Array(x);K.push(J)}return new Blob(K,{type:e})}placeData(a){var e=this;try{setTimeout((0,f.Z)(function*(){yield e.inputAlatKesehatanServices.updateAlatKesehatanCalibration(e.id_alat,a,e.token),yield e.inputAlatKesehatanServices.uploadImage(e.id_alat,e.blobData,e.image_ext,e.token),e.isLoading=!1,e.global.hideLoader(),e.router.navigate(["/menu/jadwal-kalibrasi"],{})}),1e3)}catch(s){throw s}}saveData(){this.isLoading=!0,this.global.showLoader(),console.log(this.myForm.value),this.placeData(this.myForm.value),this.isLoading=!1,this.global.hideLoader()}}return n.\u0275fac=function(a){return new(a||n)(t.Y36(l.F0),t.Y36(d.U),t.Y36(h.f),t.Y36(p.e),t.Y36(g.qu),t.Y36(A.l),t.Y36(i.BX))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-update-kalibrasi"]],decls:59,vars:10,consts:[[1,"ion-no-border"],["slot","start"],[3,"fullscreen"],[1,"ion-margin",3,"formGroup","ngSubmit"],["class","ion-text-center alignSpinner",4,"ngIf"],[1,"ctm-font-2"],["formControlName","name","type","text",3,"readonly"],["onError","this.src='assets/download.jpeg'","alt","",1,"center",3,"src"],["interface","action-sheet","formControlName","calibration_status","placeholder","Status Kalibrasi",3,"ngModel","ngModelChange"],["value","berhasil_kalibrasi"],["value","gagal_kalibrasi"],["name","cloud-upload-outline","slot","end",3,"click"],["type","submit","expand","full","color","success","shape","round","expand","block"],["expand","full","color","medium","shape","round"],[3,"ngSwitch"],[3,"ngTemplateOutlet",4,"ngSwitchCase"],["hidden",""],["show",""],[1,"ion-text-center","alignSpinner"],["color","primary"],[3,"ngTemplateOutlet"],["expand","full","color","danger","shape","round","expand","block",3,"click"]],template:function(a,e){1&a&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",1),t._UZ(5,"ion-back-button"),t.qZA()()(),t.TgZ(6,"ion-content",2)(7,"form",3),t.NdJ("ngSubmit",function(){return e.saveData()}),t.YNc(8,M,2,0,"div",4),t.TgZ(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"ion-label",5),t._uU(13,"Nama Alat"),t.qZA(),t.TgZ(14,"ion-item"),t._UZ(15,"ion-input",6),t.qZA()()()(),t.TgZ(16,"ion-grid")(17,"ion-row")(18,"ion-col")(19,"ion-label",5),t._uU(20,"Foto Alat"),t.qZA(),t._UZ(21,"img",7),t.qZA()()(),t.TgZ(22,"ion-grid")(23,"ion-row")(24,"ion-col")(25,"ion-label",5),t._uU(26,"Kondisi Alat"),t.qZA(),t.TgZ(27,"ion-list")(28,"ion-item")(29,"ion-select",8),t.NdJ("ngModelChange",function(v){return e.myForm.form=v}),t.TgZ(30,"ion-select-option",9),t._uU(31,"Berhasil Kalibrasi"),t.qZA(),t.TgZ(32,"ion-select-option",10),t._uU(33,"Gagal Kalibrasi"),t.qZA()()()()()()(),t.TgZ(34,"ion-grid")(35,"ion-row")(36,"ion-col")(37,"ion-label",5),t._uU(38,"Nama Alat"),t.qZA(),t.TgZ(39,"ion-item")(40,"ion-icon",11),t.NdJ("click",function(){return e.uploadImage()}),t.qZA()()()()(),t.TgZ(41,"ion-grid")(42,"ion-row")(43,"ion-col")(44,"ion-button",12),t._uU(45,"Simpan"),t.qZA()(),t.TgZ(46,"ion-col")(47,"ion-button",13),t._uU(48,"Kembali"),t.qZA()()()(),t.TgZ(49,"ion-grid")(50,"ion-row")(51,"ion-col"),t.ynx(52,14),t.YNc(53,N,1,1,"ng-container",15),t.YNc(54,E,1,1,"ng-container",15),t.BQk(),t.YNc(55,O,0,0,"ng-template",null,16,t.W1O),t.YNc(57,D,2,0,"ng-template",null,17,t.W1O),t.qZA()()()()()),2&a&&(t.xp6(3),t.hij(" ",e.formTitle," "),t.xp6(3),t.Q6J("fullscreen",!0),t.xp6(1),t.Q6J("formGroup",e.myForm),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(7),t.Q6J("readonly",!0),t.xp6(6),t.Q6J("src",e.global.getSantizeUrl(e.imgUrl),t.LSH),t.xp6(8),t.Q6J("ngModel",e.myForm.form),t.xp6(23),t.Q6J("ngSwitch",e.messageMonth),t.xp6(1),t.Q6J("ngSwitchCase",!1),t.xp6(1),t.Q6J("ngSwitchCase",!0))},dependencies:[r.O5,r.tP,r.RF,r.n9,g._Y,g.JJ,g.JL,g.sg,g.u,i.oU,i.YG,i.Sm,i.wI,i.W2,i.jY,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.Nd,i.t9,i.n0,i.PQ,i.wd,i.sr,i.QI,i.j9,i.cs],styles:["ion-avatar[_ngcontent-%COMP%]{width:150px;height:150px;margin-top:20px}ion-grid[_ngcontent-%COMP%]{margin-top:10px}"]}),n})()}];let I=(()=>{class n{}return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.Bz.forChild(F),l.Bz]}),n})(),B=(()=>{class n{}return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[r.ez,g.u5,g.UX,i.Pc,I]}),n})()},2690:(C,_,o)=>{o.d(_,{f:()=>P});var r=o(5861),i=o(5619),l=o(6689),f=o(7852),g=o(6751);let P=(()=>{class b{constructor(c,u){this.loadingController=c,this.api=u,this._modeldataNotification=new i.X(null)}saveInputAlatKesehatan(c,u){this.api.saveInputAlatKesehatan(c,u).then(function(){var t=(0,r.Z)(function*(d){"success"==JSON.parse(d).meta.status?console.log("data sukses disimpan"):console.log("data gagal disimpan")});return function(d){return t.apply(this,arguments)}}())}updateAlatKesehatan(c,u,t){var d=this;this.api.updateAlatKesehatan(c,u,t).then(function(){var h=(0,r.Z)(function*(p){const A=JSON.parse(p);"success"==A.meta.status?(console.log("data sukses disimpan"),d.sendAndCreateNotificationMonitoring(c,A,t)):console.log("data gagal disimpan")});return function(p){return h.apply(this,arguments)}}())}updateAlatKesehatanCalibration(c,u,t){var d=this;this.api.updateAlatKesehatanCalibration(c,u,t).then(function(){var h=(0,r.Z)(function*(p){"success"==JSON.parse(p).meta.status?(console.log("data sukses disimpan"),d.sendAndCreateNotificationCalibration(c,u,t)):console.log("data gagal disimpan")});return function(p){return h.apply(this,arguments)}}())}sendAndCreateNotificationMonitoring(c,u,t){this.api.sendAndCreateNotificationMonitoring(c,u,t).then(function(){var d=(0,r.Z)(function*(h){JSON.parse(h),console.log("data sukses disimpan")});return function(h){return d.apply(this,arguments)}}())}sendAndCreateNotificationCalibration(c,u,t){this.api.sendAndCreateNotificationCalibration(c,u,t).then(function(){var d=(0,r.Z)(function*(h){"success"==JSON.parse(h).meta.status?console.log("data sukses disimpan"):console.log("data gagal disimpan")});return function(h){return d.apply(this,arguments)}}())}sendAndCreateNotificationBPFK(c,u){this.api.sendAndCreateNotificationBPFK(c,u).then(function(){var t=(0,r.Z)(function*(d){"success"==JSON.parse(d).meta.status?console.log("data sukses disimpan"):console.log("data gagal disimpan")});return function(d){return t.apply(this,arguments)}}())}uploadImage(c,u,t,d){this.api.uploadImage(c,u,t,d).then(function(){var h=(0,r.Z)(function*(p){console.log("image upload",p),"success"==JSON.parse(p).meta.status?console.log("data sukses disimpan"):console.log("data gagal disimpan")});return function(p){return h.apply(this,arguments)}}())}}return b.\u0275fac=function(c){return new(c||b)(l.LFG(f.HT),l.LFG(g.k))},b.\u0275prov=l.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},5557:(C,_,o)=>{o.d(_,{l:()=>i});var r=o(6689);let i=(()=>{class l{constructor(){}setExtras(g){this.extras=g}getExtras(){return this.extras}}return l.\u0275fac=function(g){return new(g||l)},l.\u0275prov=r.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()}}]);